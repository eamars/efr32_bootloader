# configuration for target
MESSAGE("ENTER ${CMAKE_CURRENT_SOURCE_DIR}")

# get module name
GET_FILENAME_COMPONENT(LIB_NAME ${CMAKE_CURRENT_SOURCE_DIR} NAME)

# create a list of device drivers
SET(ENABLED_DRIVERS
		usb_gecko
		)

# include dependencies
FOREACH(MODULE ${ENABLED_DRIVERS})
	SET(TARGET_SPECIFIC_INCLUDE_DIRECTORY
			${TARGET_SPECIFIC_INCLUDE_DIRECTORY}
			${CMAKE_CURRENT_SOURCE_DIR}/${MODULE}/inc
			)

	# update include list
	INCLUDE_DIRECTORIES(${TARGET_SPECIFIC_INCLUDE_DIRECTORY})
ENDFOREACH(MODULE)

# build modules
FOREACH(MODULE ${ENABLED_DRIVERS})
	# compile those libraries
	ADD_SUBDIRECTORY("${MODULE}")
ENDFOREACH(MODULE)

INCLUDE_DIRECTORIES(${TARGET_SPECIFIC_INCLUDE_DIRECTORY})

# create library
ADD_LIBRARY(${LIB_NAME}
		"middleware.c"
		)

ADD_DEPENDENCIES(${LIB_NAME} ${ENABLED_DRIVERS})

# forward include header files
SET(TARGET_SPECIFIC_INCLUDE_DIRECTORY ${TARGET_SPECIFIC_INCLUDE_DIRECTORY} PARENT_SCOPE)
